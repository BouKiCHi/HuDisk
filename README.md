# HuDisk

## 説明
ディスクイメージを操作するためのソフトウェアです。  
動作には.NET Framework 4.7が必要になります。

## 使用方法
```
Usage HuDisk image.d88 [files...] [options...]
```


* ファイルをディスクイメージに追加
```
 hudisk -a image.d88 file.bin
 hudisk -a image.2d file.bin

 hudisk -a image.d88 iplprogram.bin --ipl IPLNAME
```
ディスクイメージファイルのimage.d88がなければ自動的に作成します。  
また、拡張子を2dとすることで、プレーンフォーマットも利用できます。  

### IPLについて
iplオプションで追加されたファイルはIPLプログラムとして登録されます。  
入力例では、IPL表示名はIPLNAMEになります。  
IPLプログラムとして登録する場合はファイルサイズ分の連続したクラスタが必要になります。


* ディスクイメージからファイルを取り出す
```
 hudisk -x image.d88 
 hudisk -x image.d88 test*.bin
```

* フォーマットのみを行う
```
 hudisk --format image.d88
```

* 2HDフォーマットを行う
```
 hudisk --format --type 2hd image.d88
```


## オプション

+ -a,--add files ...  ファイル追加
+ -x,--extract files ... ファイル展開
+ -l,--list ... ファイル一覧
+ -d,--delete ... ファイル削除

+ --format ... イメージをフォーマットする
+ --type {type} ディスク種別を選択する。2HD/2D。
+ -i,--ipl {iplname} ... IPLバイナリとして追加する
+ -r,--read  {address} ... 読み出しアドレスの設定
+ -g,--go  {address} ... 実行アドレスの設定
+ --x1s ... x1save.exe互換モードに設定
+ --name {name} イメージ上のエントリ名をnameに設定

+ -h,-?,--help ... 表示

## 説明
* X1SAVE.EXE互換モードは、アロケーションテーブルをX1SAVE.EXEの出力に合わせる調整を行うオプションです。  
具体的には最終セクタ数が1以上で-1にします。ただしファイルサイズの下位8bitが0であれば、+1をします。

* フォーマットはイメージをフォーマットします。

* 読み出しアドレスの指定は接頭辞なしの16進数です。  
hudisk image.d88 file.bin --read 1234 --go 1234  
とすると、  
読み出しアドレスが$1234(10進数で4660)に設定されます。

## 未指定時の初期値
* 読み出しアドレス = $0000
* 実行アドレス = $0000
* ファイル書き込みの基本はバイナリモード

## 技術情報
+ [ディスクフォーマット](doc/DISK.MD)
+ [HuBASICフォーマット](doc/HuBASIC_Format.md)

## 履歴
* ver 1.07
2HDフォーマット機能の追加。

* ver 1.06
2HDへの対応(フォーマット、ベタイメージ取扱いには現時点では未対応)。

* ver 1.05
基本的な構造変更。  
展開機能時に大文字小文字を区別しないようにした。  
削除機能の追加。  
イメージ上のファイル名を別名にする機能の追加。

* ver 1.04
ファイル名がフォーマットの規定サイズよりも大きい場合に生じる不具合を修正。  
X1Sオプションの追加。
IPLモード時は連続したクラスタを探すようにした。

* ver 1.03
アーカイブ構造の修正。  

* ver 1.02
デフォルトの動作モードをリストにした。  
ファイルの日付をリストで表示するようにした。

* ver 1.01
ファイルの日付を設定するようにした。

* ver 1.0
初期リリース

